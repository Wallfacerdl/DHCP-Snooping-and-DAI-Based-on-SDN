# ğŸ›¡ï¸ SDNç½‘ç»œå®‰å…¨ç®¡ç†é¡¹ç›®

ä¸€ä¸ªåŸºäº**Ryuæ§åˆ¶å™¨**å’Œ**Mininet**çš„è½¯ä»¶å®šä¹‰ç½‘ç»œï¼ˆSDNï¼‰å®‰å…¨é¡¹ç›®ï¼Œå®ç°äº†**DHCP Snooping**å’Œ**åŠ¨æ€ARPæ£€æµ‹ï¼ˆDAIï¼‰** åŠŸèƒ½ï¼Œæœ‰æ•ˆé˜²æŠ¤å±€åŸŸç½‘å†…çš„ARPæ¬ºéª—æ”»å‡»å’Œéæ³•DHCPæœåŠ¡å™¨ã€‚

## **ğŸ“‹ ç›®å½•**

- é¡¹ç›®ç®€ä»‹
- æ ¸å¿ƒåŠŸèƒ½
- ç³»ç»Ÿæ¶æ„
- ç¯å¢ƒè¦æ±‚
- å¿«é€Ÿå¼€å§‹
- è¯¦ç»†ä½¿ç”¨æŒ‡å—
- æµ‹è¯•ä¸éªŒè¯
- é¡¹ç›®ç»“æ„
- æ•…éšœæ’é™¤
- åç»­å¼€å‘

## **ğŸš€ é¡¹ç›®ç®€ä»‹**

æœ¬é¡¹ç›®æ¼”ç¤ºäº†åœ¨SDNç¯å¢ƒä¸­å¦‚ä½•é€šè¿‡ä¸­å¤®æ§åˆ¶å™¨å®ç°äºŒå±‚ç½‘ç»œå®‰å…¨ç­–ç•¥ï¼š

- **DHCP Snooping**ï¼šåŒºåˆ†ä¿¡ä»»ä¸éä¿¡ä»»ç«¯å£ï¼Œåªå…è®¸åˆæ³•DHCPæœåŠ¡å™¨å“åº”
- **åŠ¨æ€ARPæ£€æµ‹ï¼ˆDAIï¼‰**ï¼šéªŒè¯ARPå“åº”çš„åˆæ³•æ€§ï¼Œé˜²æ­¢IP-MACæ˜ å°„è¢«ç¯¡æ”¹
- **DHCPé¥¿æ­»æ”»å‡»é˜²æŠ¤**ï¼šæ£€æµ‹å¹¶æ‹¦æˆªå¤§é‡ä¼ªé€ çš„DHCP DiscoveræŠ¥æ–‡
- **å®æ—¶ç›‘æ§**ï¼šå¯¹ç½‘ç»œä¸­çš„ARPå’ŒDHCPæŠ¥æ–‡è¿›è¡Œæ·±åº¦æ£€æµ‹ä¸æ§åˆ¶

## **âœ¨ æ ¸å¿ƒåŠŸèƒ½**

### **âœ… å·²å®ç°åŠŸèƒ½**

- **éæ³•DHCPæœåŠ¡å™¨å±è”½**ï¼šè‡ªåŠ¨æ‹¦æˆªéä¿¡ä»»ç«¯å£çš„DHCPå“åº”æŠ¥æ–‡
- **ARPæ¬ºéª—æ”»å‡»é˜²æŠ¤**ï¼šå®æ—¶æ£€æµ‹å¹¶æ‹¦æˆªä¼ªé€ çš„ARPè¯·æ±‚/å“åº”
- **IP-MACç»‘å®šè¡¨ç®¡ç†**ï¼šåŠ¨æ€å­¦ä¹ å¹¶ç»´æŠ¤åˆæ³•çš„IP-MACæ˜ å°„å…³ç³»
- **ä¿¡ä»»ç«¯å£æœºåˆ¶**ï¼šæ”¯æŒé…ç½®ä¿¡ä»»ç«¯å£ï¼ˆå¦‚è¿æ¥åˆæ³•DHCPæœåŠ¡å™¨çš„ç«¯å£ï¼‰
- **DHCPé¥¿æ­»æ”»å‡»é˜²æŠ¤**ï¼šåŸºäºé€Ÿç‡é™åˆ¶æ£€æµ‹å¹¶æ‹¦æˆªå¤§é‡DHCPè¯·æ±‚
- **è¯¦ç»†æ—¥å¿—ç³»ç»Ÿ**ï¼šå®Œæ•´çš„æ“ä½œæ—¥å¿—ï¼Œä¾¿äºç›‘æ§å’Œè°ƒè¯•

### **ğŸ”® åç»­å¼€å‘è®¡åˆ’**

- åŠ å…¥å®¹å™¨åŒ–æŠ€æœ¯
- IPv6åè®®æ”¯æŒ
- Webå¯è§†åŒ–ç®¡ç†ç•Œé¢

## **ğŸ— ç³»ç»Ÿæ¶æ„**

```markdown
+----------------+     +----------------+     +----------------+
|   Ryuæ§åˆ¶å™¨    |     |  OpenFlowäº¤æ¢æœº  |     |   Mininetç½‘ç»œ   |
|                |     |                |     |                |
| â€¢ DHCP Snooping|â†---â†’| â€¢ æµè¡¨ç®¡ç†     |â†---â†’| â€¢ h1:åˆæ³•DHCP  |
| â€¢ DAIé˜²æŠ¤å¼•æ“  |     | â€¢ æŠ¥æ–‡è½¬å‘     |     | â€¢ h2:éæ³•DHCP  |
| â€¢ é¥¿æ­»æ”»å‡»é˜²æŠ¤ |     | â€¢ ç«¯å£çŠ¶æ€ç›‘æ§ |     | â€¢ h3:DHCPå®¢æˆ·ç«¯|
| â€¢ ç»‘å®šè¡¨ç®¡ç†   |     | â€¢ é€Ÿç‡é™åˆ¶     |     | â€¢ h4:é™æ€å®¢æˆ·ç«¯|
+----------------+     +----------------+     +----------------+
```

## **âš™ï¸ ç¯å¢ƒè¦æ±‚**

- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 22.04 LTS æˆ–æ›´é«˜ç‰ˆæœ¬
- **Python**ï¼š3.9.25
- **å¿…è¦è½¯ä»¶**ï¼š
    - Mininet
    - Ryu
    - Open vSwitch

## **ğŸš€ å¿«é€Ÿå¼€å§‹**

### **1. ç¯å¢ƒå‡†å¤‡**

**ï¼ˆ1ï¼‰Open vSwitch (OVS)/MiniNet å®‰è£…**

[Linuxä¸Šå¦‚ä½•å®ç°è½¯ä»¶å®šä¹‰ç½‘ç»œï¼ˆSDNï¼‰ï¼Ÿ_sdnåˆ›å»ºè‡ªå®šä¹‰æ‹“æ‰‘-CSDNåšå®¢](https://blog.csdn.net/gongwanzhang/article/details/151781659)

**ï¼ˆ2ï¼‰SDNæ§åˆ¶å™¨â€”â€”ryuå®‰è£…**

**githubä¸»é¡µï¼š**

[https://github.com/faucetsdn/ryu](https://github.com/faucetsdn/ryu)

```bash
# ç¡®ä¿Pythonç¯å¢ƒæ­£ç¡®ï¼ˆå¦‚æœæ‚¨ä½¿ç”¨Condaï¼‰# ä»¥ç®¡ç†å‘˜æ¨¡å¼ä¸‹è¿è¡Œï¼ˆå› ä¸ºæˆ‘condaå®‰è£…åœ¨rootç›®å½•ä¸‹ï¼‰sudo -s# åˆ›å»º3.9ç‰ˆæœ¬çš„Pythonconda create -n ryu-env python=3.9
# æ¿€æ´»åº“conda activate ryu-env
# æ›´æ–°setuptoolsï¼ˆä¸ç„¶ä¼šæŠ¥é”™ï¼‰pip uninstall setuptools
pip install setuptools==67.6.1
# å°†ä¸‹è½½å¥½çš„ryuåº“å®‰è£…åˆ°ç¯å¢ƒä¸­cd /home/Downloads/ryu
pip install .
#æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸryu-manager --version
```

### **2. å¯åŠ¨ç³»ç»Ÿ(ä¾æ—§åœ¨conda** ryu-env**ç¯å¢ƒä¸‹ï¼‰**

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•cd /home/.../SoftWareProject/dhcp_snooping_project
```

**ç»ˆç«¯1ï¼šå¯åŠ¨Ryuæ§åˆ¶å™¨**

```bash
# å¯åŠ¨Ryuæ§åˆ¶å™¨ï¼ˆè‡ªåŠ¨è®°å½•å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—ï¼‰./start_sdn.sh
```

**ç»ˆç«¯2ï¼šå¯åŠ¨Mininetå¹¶é…ç½®ç½‘ç»œ**

```bash
# è¿è¡ŒMininetè‡ªåŠ¨åŒ–é…ç½®è„šæœ¬sudo python mininet_setup.pysudo ./mininet_setup.py
```

## **ğŸ“– è¯¦ç»†ä½¿ç”¨æŒ‡å—**

### **ç½‘ç»œé…ç½®æµç¨‹**

å½“Mininetå¯åŠ¨åï¼Œè‡ªåŠ¨åŒ–è„šæœ¬ä¼šæ‰§è¡Œä»¥ä¸‹é…ç½®ï¼š

1. **æ¸…ç†ç¯å¢ƒ**ï¼šç¡®ä¿æ— æ—§ç½‘ç»œé…ç½®æ®‹ç•™
2. **åˆ›å»ºæ‹“æ‰‘**ï¼šå•äº¤æ¢æœº4ä¸»æœºæ‹“æ‰‘ï¼ˆh1-h4ï¼‰
3. **é…ç½®ä¸»æœº**ï¼ˆåŸºäºConfigç±»è®¾ç½®ï¼Œå¯è‡ªè¡Œè®¾ç½®æˆ–é»˜è®¤ï¼‰ï¼š
    - **h1**ï¼šåˆæ³•DHCPæœåŠ¡å™¨ï¼ˆ10.0.0.100ï¼Œä¿¡ä»»ç«¯å£ï¼‰
    - **h2**ï¼šéæ³•DHCPæœåŠ¡å™¨ï¼ˆ10.0.0.200ï¼Œéä¿¡ä»»ç«¯å£ï¼‰
    - **h3**ï¼šDHCPå®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨è·å–IPï¼‰
    - **h4**ï¼šé™æ€IPå®¢æˆ·ç«¯ï¼ˆ10.0.0.4ï¼‰
4. **å¯åŠ¨æœåŠ¡**ï¼šåœ¨h1å’Œh2ä¸Šå¯åŠ¨dnsmasqæœåŠ¡
5. ç»“æŸæ—¶è¾“å‡ºæ—¥å¿—

### **é…ç½®ç®¡ç†ç³»ç»Ÿ**

é¡¹ç›®ä½¿ç”¨Configå•ä¾‹ç±»ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®ï¼š

```python
# config.py - é…ç½®ç®¡ç†ç±»class Config:    def _init_config(self):
        self.TRUSTED_PORTS = {1}
        self.STATIC_DEVICES = [
            {
                "mac": "00:00:00:00:00:01",
                "ip": "10.0.0.100",
                "port": 1,
                "description": "h1 (DHCPæœåŠ¡å™¨)",
            },
# ...æ›´å¤šè®¾å¤‡é…ç½®        ]
```

## **ğŸ§ª æµ‹è¯•ä¸éªŒè¯**

### **è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹**

é¡¹ç›®åŒ…å«å®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼Œæ‰§è¡Œä»¥ä¸‹æµ‹è¯•åºåˆ—ï¼š

1. **åŸºç¡€è¿é€šæ€§æµ‹è¯•**ï¼šéªŒè¯ç½‘ç»œåŸºç¡€åŠŸèƒ½
2. **DHCPåŠŸèƒ½æµ‹è¯•**ï¼šç¡®ä¿h3èƒ½æ­£ç¡®ä»h1è·å–IP
3. **DAIé˜²æŠ¤æµ‹è¯•**ï¼šè‡ªåŠ¨æ‰§è¡ŒARPæ¬ºéª—æ”»å‡»å¹¶éªŒè¯é˜²æŠ¤æ•ˆæœ

### **æ‰‹åŠ¨æµ‹è¯•å‘½ä»¤**

åœ¨Mininet CLIä¸­å¯æ‰§è¡Œä»¥ä¸‹æµ‹è¯•ï¼š

### **åŸºç¡€åŠŸèƒ½æµ‹è¯•**

```bash
# æµ‹è¯•å…¨ç½‘è¿é€šæ€§pingall# æµ‹è¯•h4åˆ°h1çš„è¿é€šæ€§h4 ping -c 3 h1
# æŸ¥çœ‹å„ä¸»æœºIPé…ç½®h1 ifconfig h1-eth0
h2 ifconfig h2-eth0
h3 ifconfig h3-eth0
h4 ifconfig h4-eth0
```

### **DAIåŠŸèƒ½æµ‹è¯•ï¼ˆæ¥è‡ªæ–‡ä»¶h4_attack.txt)**

```
# åœ¨h4ä¸Šæ‰§è¡ŒARPæ¬ºéª—æ”»å‡»ï¼ˆæµ‹è¯•DAIåŠŸèƒ½ï¼‰
h4 python3 -c "
import socket
import struct

s = socket.socket(socket.AF_PACKET, socket.SOCK_RAW)
s.bind(('h4-eth0', 0))
#è®¾ç½®æˆh3çš„IPï¼Œè§†é…ç½®çš„æƒ…å†µè€Œå˜
arp_response = (
    b'\xff\xff\xff\xff\xff\xff' +
    b'\x00\x00\x00\x00\x00\x04' +
    b'\x08\x06' +
    b'\x00\x01\x08\x00\x06\x04\x00\x02' +
    b'\x00\x00\x00\x00\x00\x04' +
    b'\x0a\x00\x00\x0d' +
    b'\x00\x00\x00\x00\x00\x00' +
    b'\x00\x00\x00\x00'
)

s.send(arp_response)
s.close()
print('ARPæ¬ºéª—åŒ…å·²å‘é€: h4å£°ç§°æ‹¥æœ‰h3çš„IP(10.0.0.13)')
"

```

### **é¢„æœŸæµ‹è¯•ç»“æœ**

**DAIé˜²æŠ¤æˆåŠŸæ—¶ï¼ŒRyuæ§åˆ¶å™¨åº”è¾“å‡ºï¼š**

```markdown
ğŸš« DAIæ‹¦æˆª: ARPæ¬ºéª—! 00:00:00:00:00:04 å£°ç§°IP 10.0.0.13, ç»‘å®šè¡¨è®°å½•ä¸º 10.0.0.4
```

**åŒæ—¶åº”éªŒè¯ï¼š**

- h1çš„ARPè¡¨æœªè¢«æ±¡æŸ“ï¼ˆh3çš„IPä»æŒ‡å‘h3çš„MACï¼‰
- h3ä¸h1ä¹‹é—´çš„æ­£å¸¸é€šä¿¡ä¸å—å½±å“

### **Dosæ”»å‡»æµ‹è¯•**

```bash
# åœ¨h4ä¸Šæ‰§è¡ŒDosæ”»å‡»è„šæœ¬
mininet>
h4 python3 ./dhcp_dos_simple.py h4-eth0
```


### **é¢„æœŸæµ‹è¯•ç»“æœ**


```bash
ğŸš« DHCPé€Ÿç‡è¶…é™ï¼ç«¯å£4å¯èƒ½æ­£åœ¨è¿›è¡Œé¥¿æ­»æ”»å‡»ï¼Œä¸¢å¼ƒæŠ¥æ–‡
```

## **ğŸ“ é¡¹ç›®ç»“æ„**

```markdown
sdn-security-project/
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ dhcp_snooping.py          # Ryuæ§åˆ¶å™¨ä¸»ç¨‹åº
â”œâ”€â”€ mininet_setup.py          # Mininetè‡ªåŠ¨åŒ–é…ç½®è„šæœ¬
â”œâ”€â”€ start_sdn.sh              # æ§åˆ¶å™¨å¯åŠ¨è„šæœ¬ï¼ˆå¸¦æ—¥å¿—è®°å½•ï¼‰
â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†ç±»ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰
â”œâ”€â”€ packet_processor.py       # åŒ…å¤„ç†è¿‡ç¨‹
â”œâ”€â”€ dhcp_dos_simple.py        # ç®€å•Dosæ”»å‡»æµ‹è¯•è„šæœ¬
â”œâ”€â”€ packet_processor.py       # åŒ…å¤„ç†æ¨¡å—
â”œâ”€â”€ binding_table.py          # MAC-IPç»‘å®šè¡¨æ¨¡å—
â””â”€â”€ logs                      # æ—¥å¿—æ–‡ä»¶
```

## **ğŸ”§ æ•…éšœæ’é™¤**

### **å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**

1. **æ§åˆ¶å™¨æ— æ³•å¯åŠ¨**
    
    ```bash
    # æ£€æŸ¥Ryuå®‰è£…pip list | grep ryu
    # æ£€æŸ¥Pythonç¯å¢ƒpython3 --version
    ```
    
2. **Mininetä¸»æœºæ— æ³•é€šä¿¡**
    
    ```bash
    # æ£€æŸ¥Open vSwitchçŠ¶æ€sudo service openvswitch-switch status# æ£€æŸ¥æ§åˆ¶å™¨è¿æ¥ovs-vsctl show
    ```
    
3. **DAIåŠŸèƒ½ä¸ç”Ÿæ•ˆ**
    - ç¡®è®¤æ§åˆ¶å™¨å·²æ­£ç¡®å­¦ä¹ ç»‘å®šè¡¨
    - æ£€æŸ¥Configç±»ä¸­çš„ä¿¡ä»»ç«¯å£é…ç½®
    - éªŒè¯ARPæ¬ºéª—åŒ…æ ¼å¼æ˜¯å¦æ­£ç¡®
4. **æ—¥å¿—æ–‡ä»¶é—®é¢˜**
    
    ```bash
    # æŸ¥çœ‹æœ€æ–°æ—¥å¿—æ–‡ä»¶ls -lt ryu_controller_*.log# å®æ—¶ç›‘æ§æ—¥å¿—tail -f ryu_controller_20231112_143022.log
    ```
    

### **è°ƒè¯•æŠ€å·§**

1. **å¢åŠ æ—¥å¿—è¯¦ç»†ç¨‹åº¦**
    
    ```bash
    # ä¿®æ”¹start_sdn.shä¸­çš„æ—¥å¿—çº§åˆ«ryu-manager --ofp-tcp-listen-port=6633 --verbose dhcp_snooping.py
    ```
    
2. **æ£€æŸ¥ç»‘å®šè¡¨çŠ¶æ€**
    
    ```bash
    # åœ¨Mininetä¸­æŸ¥çœ‹å„ä¸»æœºARPè¡¨h1 arp -ah2 arp -a
    ```
    
3. **éªŒè¯ç½‘ç»œè¿é€šæ€§**
    
    ```bash
    # ä½¿ç”¨pingallæµ‹è¯•å…¨ç½‘è¿é€šæ€§mininet> pingall
    ```
    

## **ğŸš€ åç»­å¼€å‘**

### **çŸ­æœŸè®¡åˆ’**

- [ ]  å®ç°Webç®¡ç†ç•Œé¢

### **é•¿æœŸè§„åˆ’**

- [ ]  å¼€å‘REST APIæ¥å£
- [ ]  åˆ›å»ºDockerå®¹å™¨åŒ–éƒ¨ç½²

## **ğŸ“§ è”ç³»æ–¹å¼**

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- é‚®ç®±ï¼šwallfacerdl@gmail.com
- é¡¹ç›®åœ°å€ï¼š[https://github.com/Wallfacerdl/SDN-project-ryu-for-dhcp_snooping](https://github.com/Wallfacerdl/DHCP-Snooping-and-DAI-Based-on-SDN)

## **ğŸ™ è‡´è°¢**

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- Ryu SDN Framework
- Mininet
- Open vSwitch

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™å®ƒä¸€ä¸ªStarï¼**
